env:
  # Telegram
  TG_CHAT: "@kaidumperx"
  TG_TOKEN: ENCRYPTED[!9277e09b33a9f0f63c6a0a87de01220561eb6ca7dc0dc3593eb1c41437fab3d5c89376aa33c0b02320eb798416818beb!]
  
  # Gitlab
  PUSH_TO_GITLAB: true
  GITLAB_GROUP: dumperx
  GITLAB_TOKEN: ENCRYPTED[!64816658a39387ca19f5be2d94bc44f32b8e4faa3ecfe9e780684c4ef5cec1edc9067ddabb12671f04373559ccd9073d!]
  GITLAB_INSTANCE: www.gitlab.com
  
  # Private SSH Key
  PRIV_SSH_KEY: ENCRYPTED[!b0c4d26d233b48b9cbe50341843177c3bba03e043780c169f42b6b2d52b12ea2a1e426b9961d66667473e05a7eed9bfb!]
task:
  name: "Firmware Dump by kaiverse"
  timeout_in: 120m
  container:
      image: ghcr.io/sushrut1101/docker:arch
      cpu: 4
      memory: 16G

  Clone_script:
      - git clone --depth=1 --single-branch https://github.com/DumprX/DumprX.git
  
  Set-SSH-Keys_script:
      - mkdir -p ~/.ssh
      - ssh-keyscan -t rsa github.com >> ~/.ssh/known_hosts
      - ssh-keyscan -t rsa gitlab.com >> ~/.ssh/known_hosts
      - ssh-keyscan -t rsa $GITLAB_INSTANCE >> ~/.ssh/known_hosts
      - echo "$PRIV_SSH_KEY" > ~/.ssh/id_rsa
      - chmod 600 ~/.ssh/id_rsa

  Setup_script:
      - git config --global user.name "Tomy Prasetyo"
      - git config --global user.email "tomy.prs25@gmail.com"
      - cd DumprX
      - echo "$GITLAB_TOKEN" > .gitlab_token
      - echo "$GITLAB_GROUP" > .gitlab_group
      - echo "$TG_CHAT" > .tg_chat
      - echo "$TG_TOKEN" > .tg_token
      - echo "$GITLAB_INSTANCE" > .gitlab_instance
      - sudo bash setup.sh

  DumprX_script:
      - cd DumprX || echo "Already in the Directory"
      - ./dumper.sh $(< ${CIRRUS_WORKING_DIR}/ROM_URL.txt)
